<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1326FD">
    <title>MC Recovery Fund - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç</title>
    <meta name="description" content="–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ MC Recovery Fund. –ö–≤–∏–∑—ã, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —ç—Ñ–∏—Ä—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã.">
    <meta property="og:title" content="MC Recovery Fund - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç">
    <meta property="og:description" content="–û–±—É—á–µ–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–≤–∏–∑—ã –∏ –ø–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏">
    <meta property="og:image" content="logo-mc-recovery.webp">
    <meta property="og:type" content="website">
    <link rel="icon" href="favicon.webp" type="image/webp">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="favicon.webp">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MC Recovery">
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://api.hyperliquid.xyz">
    <link rel="dns-prefetch" href="https://telegram.org">
    
    <!-- Critical CSS - –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Non-critical fonts - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap&subset=cyrillic" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap&subset=cyrillic" rel="stylesheet"></noscript>
    
    <!-- Telegram Web App SDK - defer –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <script src="https://telegram.org/js/telegram-web-app.js" defer></script>
    <script>
      // Initialize theme before page load to prevent flash
      (function() {
        try {
          var saved = localStorage.getItem('theme');
          var tg = window.Telegram && window.Telegram.WebApp;
          var fromTG = tg && tg.colorScheme; // 'dark' | 'light'
          var theme = saved && (saved === 'light' || saved === 'dark')
            ? saved
            : (fromTG || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
          document.documentElement.setAttribute('data-theme', theme);
        } catch(_) {}
      })();
    </script>
</head>
<body>
    <!-- App Container -->
    <div id="app" class="app">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-content">
                <div class="topbar-logo">
                    <img src="favicon.webp" alt="MC Recovery Fund" width="28" height="28" style="border-radius: 6px;" loading="eager">
                    <span class="topbar-title">MC Recovery Fund</span>
                </div>
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button class="btn-icon" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <svg class="theme-icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <path d="M12 4V2m0 20v-2M4 12H2m20 0h-2M5.64 5.64l-1.42-1.42M19.78 19.78l-1.42-1.42M5.64 18.36l-1.42 1.42M19.78 4.22l-1.42 1.42"/>
                            <circle cx="12" cy="12" r="4" fill="currentColor"/>
                        </svg>
                        <svg class="theme-icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
                        </svg>
                    </button>
                    <button class="btn-icon" id="backBtn" aria-label="–ù–∞–∑–∞–¥">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="content" class="content content-wrapper">
            <!-- Screens will be injected here -->
        </main>

        <!-- Tab Bar Navigation -->
        <nav id="tabBar" class="tab-bar">
            <!-- Tab items will be injected by JavaScript -->
        </nav>

        <!-- Loading Skeleton -->
        <div id="skeleton" class="skeleton-screen">
            <div class="skeleton-box skeleton-title"></div>
            <div class="skeleton-box skeleton-text"></div>
            <div class="skeleton-box skeleton-text"></div>
            <div class="skeleton-box skeleton-card"></div>
            <div class="skeleton-box skeleton-card"></div>
        </div>
    </div>

    <!-- Optimized Data Loading Strategy -->
    <script>
        // Initialize APP_DATA with empty structures
        window.APP_DATA = {
            quizzes: [],
            glossary: [],
            edu: [],
            instructions: {},
            announcements: [],
            broadcasts: {},
            documents: [],
            support: {},
            dashboard: {},
            faq: {},
            literature: {},
            _loaded: {}, // Track loaded modules
            _loading: {} // Track loading promises to avoid duplicate requests
        };
        
        // Data loading status
        window.APP_DATA_READY = false;
        
        // Lazy data loader function
        window.loadDataModule = function(moduleName) {
            // Return cached data if already loaded
            if (window.APP_DATA._loaded[moduleName]) {
                return Promise.resolve(window.APP_DATA[moduleName]);
            }
            
            // Return existing loading promise if in progress
            if (window.APP_DATA._loading[moduleName]) {
                return window.APP_DATA._loading[moduleName];
            }
            
            // Start loading
            const loadingPromise = fetch(`data/${moduleName}.json`)
                .then(r => {
                    if (!r.ok) throw new Error(`Failed to load ${moduleName}`);
                    return r.json();
                })
                .then(data => {
                    window.APP_DATA[moduleName] = data;
                    window.APP_DATA._loaded[moduleName] = true;
                    delete window.APP_DATA._loading[moduleName];
                    return data;
                })
                .catch(err => {
                    console.error(`Failed to load ${moduleName}:`, err);
                    delete window.APP_DATA._loading[moduleName];
                    throw err;
                });
            
            window.APP_DATA._loading[moduleName] = loadingPromise;
            return loadingPromise;
        };
        
        // Load CRITICAL data only for initial render (home page needs)
        // Other data will be loaded on-demand when navigating to specific sections
        Promise.all([
            window.loadDataModule('quizzes'),
            window.loadDataModule('dashboard')
        ]).then(() => {
            window.APP_DATA_READY = true;
            document.dispatchEvent(new CustomEvent('app-data-ready'));
        }).catch(err => {
            console.error('Failed to load critical data:', err);
            document.getElementById('skeleton').style.display = 'none';
            document.getElementById('content').innerHTML = `
                <div class="card" style="text-align: center; padding: var(--space-xl);">
                    <div style="font-size: 64px; margin-bottom: var(--space-lg);">‚ö†Ô∏è</div>
                    <h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>
                    <p class="caption mb-lg">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>
                    <button class="btn btn-primary" onclick="location.reload()" style="min-width: 200px;">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    </button>
                </div>
            `;
        });
        
        // Prefetch non-critical data in the background when browser is idle
        if ('requestIdleCallback' in window) {
            requestIdleCallback(() => {
                // Load frequently accessed data
                ['instructions', 'faq', 'glossary'].forEach(module => {
                    window.loadDataModule(module).catch(() => {});
                });
            }, { timeout: 2000 });
            
            // Load less critical data with lower priority
            requestIdleCallback(() => {
                ['edu', 'announcements', 'broadcasts', 'documents', 'support', 'literature'].forEach(module => {
                    window.loadDataModule(module).catch(() => {});
                });
            }, { timeout: 5000 });
        } else {
            // Fallback for browsers without requestIdleCallback
            setTimeout(() => {
                ['instructions', 'faq', 'glossary', 'edu', 'announcements', 'broadcasts', 'documents', 'support', 'literature'].forEach(module => {
                    window.loadDataModule(module).catch(() => {});
                });
            }, 1000);
        }
    </script>
    <script src="app.js" defer></script>
</body>
</html>
